<!DOCTYPE html>
<html lang="pt-br">
<head>
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Código Projeto Adega</title>
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: Consolas, monospace;
            padding: 20px;
            font-size: 8px; 
        }
        h1 {
            color: violet;
            font-size: 14px;
        }
        pre {
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 15px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }
        a {
            color: violet;
            text-decoration: none;
        }
    </style>
</head>
<body style="background-color:#111; color:#fff; font-family: monospace; white-space: pre-wrap;">
    <h1>
import customtkinter as ctk
import mysql.connector
from datetime import datetime       

conexao = mysql.connector.connect(
host="localhost",
user="seu_usuario",
password="sua_senha",
database="adega"
)

# cursor = conexao.cursor()
# print("Conectado ao MySQL com sucesso!")

        
def janela_login():
    ctk.set_appearance_mode('dark')
    tela_login = ctk.CTk()
    tela_login.geometry('400x400')
    tela_login.title('Login Adega 4 amigos')
    tela_login.iconbitmap("uvas2.ico") 
    frame1 = ctk.CTkFrame(tela_login, width=300, height=350)
    frame1.pack(pady=10, padx=10, anchor='center')
    frame1.pack_propagate(False)
    frame2 = ctk.CTkFrame(frame1, width=200, height=50)
    frame2.pack(pady=10, padx=10)
    frame2.pack_propagate(False)
    label1 = ctk.CTkLabel(frame2, text='Faça o login', font=('arial', 20, 'bold'))
    label1.pack(pady=10)
    label_usuario = ctk.CTkLabel(frame1, text='Usuário', font=('arial', 15, 'bold'))
    label_usuario.pack(pady=2)
    campo_usuario = ctk.CTkEntry(frame1, placeholder_text='Digite o usuário')
    campo_usuario.pack(pady=8)
    label_senha = ctk.CTkLabel(frame1, text='Senha', font=('arial', 15, 'bold'))
    label_senha.pack(pady=8)
    campo_senha = ctk.CTkEntry(frame1, placeholder_text='Digite a senha', show='*')
    campo_senha.pack(pady=2)
    btn_login = ctk.CTkButton(frame1, text='Login', width=200, height=30, corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          command=lambda: validar_login(campo_usuario, campo_senha, resultado_login, tela_login))
    btn_login.pack(pady=35)
    resultado_login = ctk.CTkLabel(frame1, text='', font=('arial', 15, 'bold'))
    resultado_login.pack(pady=5)
    tela_login.mainloop()

def validar_login(campo_usuario, campo_senha, resultado_login, tela_login):
    usuario_login = campo_usuario.get()
    senha_login = campo_senha.get()
    if usuario_login == 'adega' and senha_login == '12345':
        tela_login.withdraw()
        janela_adega()
    else:
        resultado_login.configure(text='Usuário ou senha incorretos', text_color='red')
    
def janela_adega():
    tela_adega = ctk.CTk()
    ctk.set_appearance_mode('dark')
    tela_adega.geometry('800x600')
    tela_adega.title('Adega 4 amigos')
    tela_adega.iconbitmap("uvas2.ico") 
    frame_adega = ctk.CTkFrame(tela_adega, width=700, height=500, corner_radius=15)
    frame_adega.place(relx=0.5, rely=0.5, anchor='center')
    frame_adega.pack_propagate(False)
    titulo_bemvindo = ctk.CTkLabel(frame_adega, text='Bem vindo ao gerenciamento da Adega 4 amigos!', font=('Arial', 24, 'bold'))
    titulo_bemvindo.pack(pady=50, padx = 20)
    titulo2 = ctk.CTkLabel(frame_adega, text='O que deseja fazer?', font=('Arial', 20, 'bold'))
    titulo2.pack(pady=20, padx = 20)
    btn_inserir = ctk.CTkButton(frame_adega, text='Cadastrar vinho', corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: inserir(conexao))
    btn_inserir.pack(pady=10, padx=10)
    btn_inserir.pack_propagate(False)
    btn_atualizar = ctk.CTkButton(frame_adega, text='Atualizar vinho', corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: atualizar(conexao))
    btn_atualizar.pack(pady=10, padx=10)
    btn_atualizar.pack_propagate(False)
    btn_deletar = ctk.CTkButton(frame_adega, text='Deletar vinho',corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: deletar(conexao))
    btn_deletar.pack(pady=10, padx=10)
    btn_deletar.pack_propagate(False)
    btn_listar = ctk.CTkButton(frame_adega, text='Listar vinhos', corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: listar(conexao))
    btn_listar.pack(pady=10, padx=10)
    btn_listar.pack_propagate(False)
    tela_adega.mainloop()

def inserir(conexao):
    janela = ctk.CTkToplevel()
    janela.title("Inserir Vinho")
    janela.geometry("300x400")
    entry_nome = ctk.CTkEntry(janela, placeholder_text="Nome")
    entry_nome.pack(pady=10)
    entry_tipo = ctk.CTkEntry(janela, placeholder_text="Tipo")
    entry_tipo.pack(pady=10)
    entry_ano = ctk.CTkEntry(janela, placeholder_text="Ano (ex: 2020)")
    entry_ano.pack(pady=10)
    entry_quantidade = ctk.CTkEntry(janela, placeholder_text="Quantidade (ml)")
    entry_quantidade.pack(pady=10)
    entry_preco = ctk.CTkEntry(janela, placeholder_text="Preço (R$)")
    entry_preco.pack(pady=10)
    resultado = ctk.CTkLabel(janela, text="")
    resultado.pack(pady=10)

    def salvar():
        try:
            nome = entry_nome.get()
            tipo = entry_tipo.get()
            ano = int(entry_ano.get())
            quantidade = int(entry_quantidade.get())
            preco = float(entry_preco.get())
            safra = datetime.strptime(str(ano), "%Y").date()
            criar_vinho(conexao, nome, tipo, safra, quantidade, preco)
            resultado.configure(text="Vinho cadastrado com sucesso!", text_color="green")
        except Exception as e:
            resultado.configure(text=f"Erro: {e}", text_color="red")
    ctk.CTkButton(janela, text="Salvar", command=salvar).pack(pady=20)

def deletar():
    def buscar_vinhos():
        nome = entry_nome.get()
        cursor = conexao.cursor()
        cursor.execute("SELECT id, nome, tipo, ano FROM tbl_vinhos WHERE nome = ?", (nome,))
        resultados = cursor.fetchall()

        for widget in frame_resultados.winfo_children():
            widget.destroy()

        if not resultados:
            ctk.CTkLabel(frame_resultados, text="Nenhum vinho encontrado.").pack()
        elif len(resultados) == 1:
            vinho = resultados[0]
            confirmar_exclusao(vinho[0], f"{vinho[1]} ({vinho[2]}, {vinho[3]})")
        else:
            ctk.CTkLabel(frame_resultados, text="Vinhos encontrados:").pack(pady=5)
            for vinho in resultados:
                texto = f"ID: {vinho[0]} | Nome: {vinho[1]} | Tipo: {vinho[2]} | Ano: {vinho[3]}"
                btn = ctk.CTkButton(frame_resultados, text=texto, command=lambda id=vinho[0], desc=texto: confirmar_exclusao(id, desc))
                btn.pack(pady=2)

    def confirmar_exclusao(vinho_id, descricao):
        for widget in frame_resultados.winfo_children():
            widget.destroy()

        ctk.CTkLabel(frame_resultados, text=f"Tem certeza que deseja excluir:\n{descricao}").pack(pady=10)

        def excluir():
            try:
                cursor.execute("DELETE FROM tbl_vinhos WHERE id = ?", (vinho_id,))
                conexao.commit()
                ctk.CTkLabel(frame_resultados, text="Vinho deletado com sucesso!", text_color="green").pack()
            except Exception as e:
                ctk.CTkLabel(frame_resultados, text=f"Erro ao deletar: {e}", text_color="red").pack()

        ctk.CTkButton(frame_resultados, text="Confirmar exclusão", fg_color="red", command=excluir).pack(pady=5)
        ctk.CTkButton(frame_resultados, text="Cancelar", command=lambda: frame_resultados.destroy()).pack(pady=2)

    janela = ctk.CTkToplevel()
    janela.title("Deletar Vinho")
    janela.geometry("500x400")

    ctk.CTkLabel(janela, text="Digite o nome do vinho que deseja excluir:").pack(pady=10)
    entry_nome = ctk.CTkEntry(janela, width=300, placeholder_text="Ex: Cabernet")
    entry_nome.pack(pady=5)

    ctk.CTkButton(janela, text="Buscar", command=buscar_vinhos).pack(pady=10)

    frame_resultados = ctk.CTkFrame(janela)
    frame_resultados.pack(fill='both', expand=True, padx=10, pady=10)


def atualizar(conexao):
    tela_atualizar = ctk.CTkToplevel()
    tela_atualizar.title("Atualizar Vinho")
    tela_atualizar.geometry("800x600")
    ctk.CTkLabel(tela_atualizar, text="Nome atual do vinho:").pack(pady=10)
    entry_nome_atual = ctk.CTkEntry(tela_atualizar, placeholder_text="Digite o nome atual do vinho:")
    entry_nome_atual.pack()
    ctk.CTkLabel(tela_atualizar, text="Novo nome do vinho:").pack(pady=10)
    entry_nome_novo = ctk.CTkEntry(tela_atualizar, placeholder_text="Digite o novo nome do vinho:")
    entry_nome_novo.pack()

    def executar_atualizacao_local():
        nome_atual = entry_nome_atual.get()
        nome_novo = entry_nome_novo.get()
        cursor = conexao.cursor()
        try:
            cursor.execute("UPDATE tbl_vinhos SET nome_vinho = %s WHERE nome_vinho = %s", (nome_novo, nome_atual))
            conexao.commit()
            ctk.CTkLabel(tela_atualizar, text="Atualizado com sucesso!", text_color="green").pack(pady=10)
        except Exception as e:
            ctk.CTkLabel(tela_atualizar, text=f"Erro: {e}", text_color="red").pack(pady=10)

    ctk.CTkButton(tela_atualizar, text="Atualizar", command=executar_atualizacao_local).pack(pady=20)

def listar(conexao):
  cursor = conexao.cursor()
  cursor.execute("SELECT * FROM tbl_vinhos")
  tbl_vinhos = cursor.fetchall()
  for vinho in tbl_vinhos:
        print(vinho)

janela_login()
        </h1>
</body>
</html>
