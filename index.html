<!DOCTYPE html>
<html lang="pt-br">
<head>
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Código Projeto Adega</title>
    <link rel="icon" type="image/x-icon" href="uvas.ico">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: Consolas, monospace;
            padding: 20px;
            font-size: 8px; 
        }
        h1 {
            color: violet;
            font-size: 14px;
        }
        pre {
            background-color: #1e1e1e;
            border-radius: 10px;
            padding: 15px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }
        a {
            color: violet;
            text-decoration: none;
        }
    </style>
</head>
<body style="background-color:#111; color:#fff; font-family: monospace; white-space: pre-wrap;">
    <h1>
        
<img src="uvas.ico" alt="Ícone de uvas" width="64" height="64">
        
---PYTHON---
   import customtkinter as ctk
import mysql.connector
from datetime import datetime

conexao = mysql.connector.connect(
    host="localhost",
    port=3306,
    user="root",
    password="root",
    database="adega"
)
cursor = conexao.cursor()
print("Conectado ao MySQL com sucesso!")

def janela_login():
    ctk.set_appearance_mode('dark')
    janela_login = ctk.CTk()
    janela_login.geometry('460x450')
    janela_login.title('Login Adega 4 amigos')
    frame1 = ctk.CTkFrame(janela_login, width=400, height=420)
    frame1.pack(pady=10, padx=10, anchor='center')
    frame1.pack_propagate(False)
    frame2 = ctk.CTkFrame(frame1, width=200, height=50)
    frame2.pack(pady=10, padx=10)
    frame2.pack_propagate(False)
    label1 = ctk.CTkLabel(frame2, text='Faça o login', font=('arial', 20, 'bold'))
    label1.pack(pady=10)
    label_usuario = ctk.CTkLabel(frame1, text='Usuário', font=('arial', 15, 'bold'))
    label_usuario.pack(pady=2)
    campo_usuario = ctk.CTkEntry(frame1, placeholder_text='Digite o usuário')
    campo_usuario.pack(pady=8)
    label_senha = ctk.CTkLabel(frame1, text='Senha', font=('arial', 15, 'bold'))
    label_senha.pack(pady=8)
    campo_senha = ctk.CTkEntry(frame1, placeholder_text='Digite a senha', show='*')
    campo_senha.pack(pady=2)
    resultado_login = ctk.CTkLabel(frame1, text='', font=('arial', 15, 'bold'))
    resultado_login.pack(pady=10)

    # AVISO E QUANTIDADE DE VINHOS CADASTRADOS
    cursor = conexao.cursor()
    cursor.execute("""
        SELECT COUNT(*) FROM tbl_vinhos
        WHERE nome_vinho IS NOT NULL
          AND tipo_vinho IS NOT NULL
          AND safra IS NOT NULL
          AND quantidade IS NOT NULL
          AND valor_vinho IS NOT NULL
    """)
    total_vinhos = cursor.fetchone()[0]
    ctk.CTkLabel(frame1, text=f"Total de vinhos cadastrados: {total_vinhos}", font=("Arial", 13, "bold")).pack(pady=2)
    if total_vinhos < 5:
        ctk.CTkLabel(
            frame1,
            text=f"⚠️ Apenas {total_vinhos} vinho(s) cadastrado(s) no estoque!",
            text_color="orange",
            font=("Arial", 14, "bold")
        ).pack(pady=2)

    btn_login = ctk.CTkButton(frame1, text='Login', width=200, height=30, corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          command=lambda: validar_login(campo_usuario, campo_senha, resultado_login, janela_login))
    btn_login.pack(pady=25)
    btn_lista = ctk.CTkButton(frame1, text='Listar vinhos', width=200, height=30, corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          command=lambda:listar(conexao))
    btn_lista.pack (pady=5)
    janela_login.mainloop()

def validar_login(campo_usuario, campo_senha, resultado_login, tela_login):
    usuario_login = campo_usuario.get()
    senha_login = campo_senha.get()
    if usuario_login == 'adega' and senha_login == '12345':
        tela_login.withdraw()
        janela_adega()
    else:
        resultado_login.configure(text='Usuário ou senha incorretos', text_color='red')
    
def janela_adega():
    janela_adega = ctk.CTk()
    ctk.set_appearance_mode('dark')
    janela_adega.geometry('800x600')
    janela_adega.title('Adega 4 amigos')
    frame_adega = ctk.CTkFrame(janela_adega, width=700, height=500, corner_radius=15)
    frame_adega.place(relx=0.5, rely=0.5, anchor='center')
    frame_adega.pack_propagate(False)
    titulo_bemvindo = ctk.CTkLabel(frame_adega, text='Bem vindo ao gerenciamento da Adega 4 amigos!', font=('Arial', 24, 'bold'))
    titulo_bemvindo.pack(pady=50, padx = 20)
    titulo2 = ctk.CTkLabel(frame_adega, text='O que deseja fazer?', font=('Arial', 20, 'bold'))
    titulo2.pack(pady=20, padx = 20)
    btn_inserir = ctk.CTkButton(frame_adega, text='Cadastrar vinho', corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: inserir(conexao))
    btn_inserir.pack(pady=10, padx=10)
    btn_inserir.pack_propagate(False)
    btn_atualizar = ctk.CTkButton(frame_adega, text='Atualizar vinho', corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: atualizar(conexao))
    btn_atualizar.pack(pady=10, padx=10)
    btn_atualizar.pack_propagate(False)
    btn_deletar = ctk.CTkButton(frame_adega, text='Deletar vinho',corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: deletar(conexao))
    btn_deletar.pack(pady=10, padx=10)
    btn_deletar.pack_propagate(False)
    btn_listar = ctk.CTkButton(frame_adega, text='Listar vinhos', corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: listar(conexao))
    btn_listar.pack(pady=10, padx=10)
    btn_listar.pack_propagate(False)
    

    btn_cadastrar_fab = ctk.CTkButton(frame_adega, text='Cadastrar fabricante', corner_radius=10,
                          fg_color='purple', hover_color='violet', font=('roboto', 12, 'bold'),
                          width=250, height=40, command=lambda: cadastrar_fabricante(conexao))
    btn_cadastrar_fab.pack(pady=10, padx=10)
    btn_cadastrar_fab.pack_propagate(False)
    janela_adega.mainloop()

def cadastrar_fabricante(conexao):
    janela = ctk.CTkToplevel()
    janela.title("Cadastrar Fabricante")
    janela.geometry("350x300")

    ctk.CTkLabel(janela, text="Nome do fabricante:").pack(pady=10)
    entry_nome = ctk.CTkEntry(janela, placeholder_text="Nome do fabricante")
    entry_nome.pack(pady=5)

    ctk.CTkLabel(janela, text="País de origem:").pack(pady=10)
    entry_pais = ctk.CTkEntry(janela, placeholder_text="País de origem")
    entry_pais.pack(pady=5)

    resultado = ctk.CTkLabel(janela, text="")
    resultado.pack(pady=10)

    def salvar_fabricante():
        nome = entry_nome.get().strip()
        pais = entry_pais.get().strip()
        if not nome or not pais:
            resultado.configure(text="Preencha todos os campos.", text_color="red")
            return
        try:
            cursor = conexao.cursor()
            cursor.execute(
                "INSERT INTO tbl_fabricantes (nome_fabricante, pais_origem) VALUES (%s, %s)",
                (nome, pais)
            )
            conexao.commit()
            resultado.configure(text="Fabricante cadastrado com sucesso!", text_color="green")
            entry_nome.delete(0, 'end')
            entry_pais.delete(0, 'end')
        except Exception as e:
            resultado.configure(text=f"Erro: {e}", text_color="red")

    ctk.CTkButton(janela, text="Salvar", command=salvar_fabricante).pack(pady=20)

def inserir(conexao):
    janela = ctk.CTkToplevel()
    janela.title("Inserir Vinho")
    janela.geometry("300x500")

    cursor = conexao.cursor()
    cursor.execute("SELECT id_fabricante, nome_fabricante FROM tbl_fabricantes")
    fabricantes = cursor.fetchall()
    nomes_fabricantes = [f[1] for f in fabricantes]

    entry_nome = ctk.CTkEntry(janela, placeholder_text="Nome")
    entry_nome.pack(pady=10)
    entry_tipo = ctk.CTkEntry(janela, placeholder_text="Tipo")
    entry_tipo.pack(pady=10)
    entry_safra = ctk.CTkEntry(janela, placeholder_text="Safra (AAAA-MM-DD)")
    entry_safra.pack(pady=10)
    entry_quantidade = ctk.CTkEntry(janela, placeholder_text="Quantidade (ml)")
    entry_quantidade.pack(pady=10)
    entry_valor = ctk.CTkEntry(janela, placeholder_text="Valor (R$)")
    entry_valor.pack(pady=10)

    ctk.CTkLabel(janela, text="Fabricante:").pack(pady=5)
    combo_fabricante = ctk.CTkComboBox(janela, values=nomes_fabricantes)
    combo_fabricante.pack(pady=10)

    resultado = ctk.CTkLabel(janela, text="")
    resultado.pack(pady=10)
    
    def criar_vinho(conexao, nome, tipo, safra, quantidade, valor, id_fabricante):
        cursor = conexao.cursor()
        cursor.execute(
            "INSERT INTO tbl_vinhos (nome_vinho, tipo_vinho, safra, quantidade, valor_vinho, fgk_fabricante) VALUES (%s, %s, %s, %s, %s, %s)",
            (nome, tipo, safra, quantidade, valor, id_fabricante)
        )
        conexao.commit()

    def salvar():
        try:
            nome = entry_nome.get()
            tipo = entry_tipo.get()
            safra = entry_safra.get()
            safra = datetime.strptime(str(safra), "%Y-%m-%d").date()
            quantidade = float(entry_quantidade.get()) 
            preco = float(entry_valor.get())
            fabricante_nome = combo_fabricante.get()
            id_fabricante = next((f[0] for f in fabricantes if f[1] == fabricante_nome), None)
            if id_fabricante is None:
                resultado.configure(text="Selecione um fabricante válido.", text_color="red")
                return
            criar_vinho(conexao, nome, tipo, safra, quantidade, preco, id_fabricante)
            resultado.configure(text="Vinho cadastrado com sucesso!", text_color="green")
        except ValueError:
            resultado.configure(text="Erro: data ou valores inválidos (use AAAA-MM-DD).", text_color="red")
        except Exception as e:
            resultado.configure(text=f"Erro: {e}", text_color="red")
        entry_nome.delete(0, 'end')
        entry_tipo.delete(0, 'end')
        entry_safra.delete(0, 'end')
        entry_quantidade.delete(0, 'end')
        entry_valor.delete(0, 'end')
    ctk.CTkButton(janela, text="Salvar", command=salvar).pack(pady=20)

def deletar(conexao):
    janela = ctk.CTkToplevel()
    janela.title("Deletar Vinho")
    janela.geometry("400x500")
    frame_resultados = ctk.CTkFrame(janela)
    frame_resultados.pack(pady=10, fill="both", expand=True)
    cursor = conexao.cursor()
    
    cursor.execute("""
        SELECT id_vinho, nome_vinho, tipo_vinho, safra 
        FROM tbl_vinhos
        WHERE nome_vinho IS NOT NULL
          AND tipo_vinho IS NOT NULL
          AND safra IS NOT NULL
          AND quantidade IS NOT NULL
          AND valor_vinho IS NOT NULL
    """)
    resultados = cursor.fetchall()

    if not resultados:
        ctk.CTkLabel(frame_resultados, text="Nenhum vinho disponível para deletar.").pack()
    else:
        ctk.CTkLabel(frame_resultados, text="Lista de Vinhos Disponíveis:").pack(pady=5)
        for vinho in resultados:
            texto = f"ID: {vinho[0]} | Nome: {vinho[1]} | Tipo: {vinho[2]} | Safra: {vinho[3]}"
            ctk.CTkLabel(frame_resultados, text=texto).pack(pady=2)
        ctk.CTkLabel(janela, text="Digite o ID do vinho que deseja deletar:").pack(pady=10)
        entry_id = ctk.CTkEntry(janela, placeholder_text="ID do vinho")
        entry_id.pack(pady=10)

        def confirmar_anulacao():
            try:
                id_vinho = int(entry_id.get())
                cursor = conexao.cursor()
                cursor.execute("SELECT nome_vinho FROM tbl_vinhos WHERE id_vinho = %s", (id_vinho,))
                vinho = cursor.fetchone()
                if vinho:
                    cursor.execute("""
                        UPDATE tbl_vinhos
                        SET nome_vinho = NULL,
                            tipo_vinho = NULL,
                            safra = NULL,
                            quantidade = NULL,
                            valor_vinho = NULL,
                            fgk_fabricante = NULL
                        WHERE id_vinho = %s
                    """, (id_vinho,))
                    conexao.commit()
                    ctk.CTkLabel(janela, text=f"Vinho com ID {id_vinho} deletado com sucesso!", text_color="green").pack()
                else:
                    ctk.CTkLabel(janela, text="ID não encontrado.", text_color="red").pack()
            except ValueError:
                ctk.CTkLabel(janela, text="Por favor, digite um ID válido.", text_color="red").pack()
            except Exception as e:
                ctk.CTkLabel(janela, text=f"Erro ao deletar: {e}", text_color="red").pack()
        ctk.CTkButton(janela, text="Confirmar", fg_color="orange", command=confirmar_anulacao).pack(pady=10)

def atualizar(conexao):
    janela = ctk.CTkToplevel()
    janela.title("Atualizar Vinho")
    janela.geometry("800x600")
    frame_resultados = ctk.CTkFrame(janela)
    frame_resultados.pack(pady=10, fill="both", expand=True)
    cursor = conexao.cursor()
    cursor.execute(    """SELECT id_vinho, nome_vinho, tipo_vinho, safra, quantidade, valor_vinho 
        FROM tbl_vinhos
        WHERE nome_vinho IS NOT NULL
          AND tipo_vinho IS NOT NULL
          AND safra IS NOT NULL
          AND quantidade IS NOT NULL
          AND valor_vinho IS NOT NULL
    """)
    resultados = cursor.fetchall()
    if not resultados:
        ctk.CTkLabel(frame_resultados, text="Nenhum vinho cadastrado.").pack()
    else:
        ctk.CTkLabel(frame_resultados, text="Lista de Vinhos Disponíveis:").pack(pady=5)
        for vinho in resultados:
            texto = f"ID: {vinho[0]} | Nome: {vinho[1]} | Tipo: {vinho[2]} | Safra: {vinho[3]}"
            ctk.CTkLabel(frame_resultados, text=texto).pack(pady=2)
        
        ctk.CTkLabel(janela, text="Digite o ID do vinho que deseja atualizar:").pack(pady=10)
        entry_id = ctk.CTkEntry(janela, placeholder_text="ID do vinho")
        entry_id.pack(pady=10)

        ctk.CTkLabel(janela, text="Escolha o campo que deseja atualizar:").pack(pady=10)
        opcoes = ['nome_vinho', 'tipo_vinho', 'safra', 'quantidade', 'valor_vinho', 'fgk_fabricante']
        combo_campo = ctk.CTkComboBox(janela, values=opcoes)
        combo_campo.pack(pady=10)

        frame_fabricantes = ctk.CTkFrame(janela)
        label_fabricantes = ctk.CTkLabel(frame_fabricantes, text="")

        def mostrar_fabricantes():
            if combo_campo.get() == 'fgk_fabricante':
                frame_fabricantes.pack(pady=10)
                cursor = conexao.cursor()
                cursor.execute("SELECT id_fabricante, nome_fabricante, pais_origem FROM tbl_fabricantes")
                fabricantes = cursor.fetchall()
                texto_fabricantes = "Fabricantes disponíveis:\n"
                for fab in fabricantes:
                    texto_fabricantes += f"ID: {fab[0]} | Nome: {fab[1]} | País: {fab[2]}\n"
                label_fabricantes.configure(text=texto_fabricantes)
                label_fabricantes.pack(pady=5)
            else:
                frame_fabricantes.pack_forget()

        combo_campo.configure(command=mostrar_fabricantes)

        ctk.CTkLabel(janela, text="Digite o novo valor:").pack(pady=10)
        entry_novo_valor = ctk.CTkEntry(janela, placeholder_text="Novo valor")
        entry_novo_valor.pack(pady=10)

        def executar_atualizacao():
            try:
                id_vinho = int(entry_id.get())
                campo = combo_campo.get()
                novo_valor = entry_novo_valor.get()

                cursor = conexao.cursor()
                query = f"UPDATE tbl_vinhos SET {campo} = %s WHERE id_vinho = %s"
                
                if campo == 'quantidade':
                    novo_valor = float(novo_valor)
                elif campo == 'valor_vinho':
                    novo_valor = float(novo_valor)
                elif campo == 'fgk_fabricante':
                    novo_valor = int(novo_valor)
                
                cursor.execute(query, (novo_valor, id_vinho))
                conexao.commit()
                ctk.CTkLabel(janela, text="Atualizado com sucesso!", text_color="green").pack(pady=10)
                
            except ValueError:
                ctk.CTkLabel(janela, text="Erro: valor inválido para o campo selecionado", text_color="red").pack(pady=10)
            except Exception as e:
                ctk.CTkLabel(janela, text=f"Erro: {e}", text_color="red").pack(pady=10)

        ctk.CTkButton(janela, text="Atualizar", command=executar_atualizacao).pack(pady=20)

def listar(conexao):
    janela = ctk.CTkToplevel()
    janela.title("Lista de Vinhos")
    janela.geometry("700x500")
    frame = ctk.CTkFrame(janela)
    frame.pack(pady=20, padx=20, fill="both", expand=True)
    scrollable = ctk.CTkScrollableFrame(frame, label_text="Vinhos cadastrados")
    scrollable.pack(padx=10, pady=10, fill="both", expand=True)
    cursor = conexao.cursor()
    cursor.execute("""
        SELECT id_vinho, nome_vinho, tipo_vinho, safra, quantidade, valor_vinho 
        FROM tbl_vinhos
        WHERE nome_vinho IS NOT NULL
          AND tipo_vinho IS NOT NULL
          AND safra IS NOT NULL
          AND quantidade IS NOT NULL
          AND valor_vinho IS NOT NULL
    """)
    vinhos = cursor.fetchall()
    if not vinhos:
        ctk.CTkLabel(scrollable, text="Nenhum vinho cadastrado.", text_color="red").pack(pady=10)
    else:
        for vinho in vinhos:
            texto = (
                f"ID: {vinho[0]} | Nome: {vinho[1]} | Tipo: {vinho[2]} | "
                f"Safra: {vinho[3]} | Quantidade: {vinho[4]}ml | Valor: R${vinho[5]:.2f}"
            )
            ctk.CTkLabel(scrollable, text=texto, anchor="w", justify="left").pack(pady=5, padx=10, anchor='w')
    
janela_login()

-------------------------------------------------------------------------------------------------------------------------

---MYSQL---
        
CREATE DATABASE adega;
USE adega;

-- Tabela de Fabricantes
CREATE TABLE tbl_fabricantes (
    id_fabricante INT AUTO_INCREMENT PRIMARY KEY,
    nome_fabricante VARCHAR(100),
    pais_origem VARCHAR(100)
);

-- Tabela de Vinhos
CREATE TABLE tbl_vinhos (
    id_vinho INT AUTO_INCREMENT PRIMARY KEY,
    nome_vinho VARCHAR(100),
    tipo_vinho VARCHAR(100),
    safra DATE,
    quantidade FLOAT,
    valor_vinho DECIMAL(10, 2),
    fgk_fabricante INT,
    FOREIGN KEY (fgk_fabricante) REFERENCES tbl_fabricantes(id_fabricante)
);

-- Tabela de Pedidos (sem quantidade, e valor total vira FK para o vinho)
CREATE TABLE tbl_pedidos (
    id_pedido INT AUTO_INCREMENT PRIMARY KEY,
    data_pedido DATE NOT NULL,
    nome_cliente VARCHAR(100) NOT NULL,
    fgk_vinho INT,
    FOREIGN KEY (fgk_vinho) REFERENCES tbl_vinhos(id_vinho)
);

-- Inserção dos Fabricantes
INSERT INTO tbl_fabricantes (nome_fabricante, pais_origem) VALUES
('Vinícola Aurora', 'Brasil'),
('Casa Valduga', 'Brasil'),
('Miolo Wine Group', 'Brasil'),
('Salton', 'Brasil'),
('Dom Bosco', 'Brasil'),
('Concha y Toro', 'Chile'),
('Trapiche', 'Argentina'),
('Gallo Family', 'EUA'),
('Baron Philippe de Rothschild', 'França'),
('Penfolds', 'Austrália');

-- Inserção dos Vinhos
INSERT INTO tbl_vinhos (nome_vinho, tipo_vinho, safra, quantidade, valor_vinho, fgk_fabricante) VALUES
('Aurora Reserva', 'Tinto Seco', '2020-01-01', 120.5, 45.90, 1),
('Valduga Chardonnay', 'Branco Seco', '2021-01-01', 85.0, 59.90, 2),
('Miolo Merlot', 'Tinto Seco', '2019-01-01', 200.0, 62.50, 3),
('Valduga Espumante', 'Espumante Brut', '2022-01-01', 150.0, 75.00, 2),
('Salton', 'Tinto Seco', '2018-01-01', 110.0, 38.90, 4),
('Dom Bosco', 'Tinto Suave', '2021-01-01', 300.0, 25.50, 5),
('Aurora Moscato', 'Branco Suave', '2022-01-01', 90.0, 34.90, 1),
('Miolo Seleção', 'Rosé Seco', '2023-01-01', 75.0, 48.00, 3),
('Casa Valduga Terroir', 'Tinto Seco', '2020-01-01', 130.0, 82.00, 2),
('Concha y Toro Reservado', 'Tinto Seco', '2021-01-01', 180.0, 55.00, 6);

-- Inserção dos Pedidos (1 vinho por pedido, valor vem da FK)
INSERT INTO tbl_pedidos (data_pedido, nome_cliente, fgk_vinho) VALUES
('2024-05-10', 'João Silva', 1),
('2024-05-11', 'Maria Oliveira', 2),
('2024-05-12', 'Carlos Souza', 3),
('2024-05-13', 'Ana Paula', 4),
('2024-05-14', 'Pedro Santos', 5),
('2024-05-15', 'Fernanda Lima', 6),
('2024-05-16', 'Lucas Pereira', 7),
('2024-05-17', 'Juliana Costa', 8),
('2024-05-18', 'Rafael Almeida', 9),
('2024-05-19', 'Camila Rocha', 10);
        </h1>
</body>
</html>
